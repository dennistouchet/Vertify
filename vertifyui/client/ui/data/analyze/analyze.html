<template name="analyze">
  <section class="right_col" role="main" style="height:900px;">
    <div class="row">
      <h1 class="page_title">{{#if isEnabled}}Detect{{else}}Analyze{{/if}}</h1>
      <div id="addErrAlign" class="alert alert-danger" style="display:none;"></div>
      {{#if hasObjects}}
        {{#if isEnabled}}
          {{> analyzeEnabled}}
        {{else}}
          {{> analyzeDisabled}}
        {{/if}}
      {{else}}
        {{> invalidAnalyze}}
      {{/if}}
    </div>
  </section>
</template>

<template name="invalidAnalyze">
  <div class="row">
    <div class="col-md-12">
      <h4 style="padding-left:10px">Looks like you do not have any Vertify Objects that can be Analyzed.</h4>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <h4 style="padding-left:10px">You must have at least one Vertify Object with alignment completed to enable analysis.
      </h4>
    </div>
  </div>
  <div class="row">
    <div class="col-md-3">
      <button class="btn btn-primary" type=button style="margin-top:10px;margin-bottom:10px;">
        <a href="/setup/align/" style="text-decoration:none;  cursor: pointer;">Align</a>
      </button>
    </div>
    <div class="col-md-3">
    </div>
    <div class="col-md-3">
    </div>
    <div class="col-md-3">
    </div>
  </div>
</template>

<template name="analyzeDisabled">
  <div class="row">
    <div class="col-md-12">
      <h4 style="padding-left:10px">Looks like no Vertify objects have been analyzed for truth.</h4>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <h4 style="padding-left:10px">Select a Vertify object and enable real-time analysis.
      </h4>
    </div>
  </div>
  {{>analyzeVertifyObjects}}
</template>

<template name="analyzeVertifyObjects">
  <div class="row" style="border-bottom: 1px solid lightgrey">
    <div class="x_panel">
      <div class="col-md-3">Vertify Object </div>
      <div class="col-md-3">Matched Objects </div>
      <div class="col-md-2">Total Records </div>
      <div class="col-md-2">Status </div>
      <div class="col-md-2">Actions </div>
    </div>
    <div>
      {{#if Template.subscriptionsReady}}
        {{#each vertify_objects}}
          {{> analyzeVertifyObjectli}}
        {{/each}}
      {{/if}}
    </div>
  </div>
</template>

<template name="analyzeVertifyObjectli">
  <div class="row" style="padding-left:20px; padding-right:20px; padding-bottom:10px;">
    <div class="col-md-3">{{name}} </div>
    <div class="col-md-3" >
      {{#each external_objects}}
        {{getExternalObjectName external_object_id}}<br/>
      {{/each}}
    </div>
    <div class="col-md-2">
      {{#each external_objects}}
        {{getRecordCount external_object_id}}<br/>
      {{/each}}
    </div>
    <div class="col-md-2">
      {{analyze_status}}
    </div>
    <div class="col-md-2">
      {{#if isAnalyzing analyze_status}}
        <div class="progress">
          <div class="progress-bar bg-blue" role="progressbar" aria-valuenow="{{analyze_percentage}}" aria-valuemin="0" aria-valuemax="100" style="width: {{analyze_percentage}}%;">
          </div>
        </div>
      {{else}}
        {{#if isEnabled analyze_status}}
          <div class="dropdown" style="display:inline-block;">
            <button class="btn btn-primary dropdown-toggle  voddlbtn" type="button" data-toggle="dropdown">
              Options
            <span class="caret"></span></button>
            <ul class="dropdown-menu voddl">
              <li><a data-id="{{id}}" href="#"> Redetect</a></li>
              <li><a data-id="{{id}}" href="#"> Disable</a></li>
            </ul>
          </div>
        {{else}}
          <div class="dropdown" style="display:inline-block;">
            <button class="btn btn-primary dropdown-toggle  voddlbtn" type="button" data-toggle="dropdown">
              Options
            <span class="caret"></span></button>
            <ul class="dropdown-menu voddl">
              <li><a data-id="{{id}}" href="#"> Enable</a></li>
            </ul>
          </div>
        {{/if}}
      {{/if}}
    </div>
  </div>
</template>

<template name="analyzeInProgress">
  <div class="row">
    <div class="col-md-12">
      <h4 style="padding-left:10px">
        Select a Vertify object and enable real-time analysis.
      </h4>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <h4 style="padding-left:10px">
        Select another Vertify object to enable analysis or start fixing your Vertify objects.
      </h4>
    </div>
  </div>
  {{> analyzeVertifyObjects}}
</template>

<template name="analyzeEnabled">
  <div class="row">
    <div class="col-md-12">
      <h4 style="padding-left:10px">
        <i class="glyphicon glyphicon-ok-circle"> </i>Detection Enabled! {{count}} Vertify object(s) analyzed for truth.
      </h4>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <h4 style="padding-left:10px">
        Select another Vertify object to enable analysis or start fixing your Vertify objects.
      </h4>
    </div>
  </div>
  {{> analyzeVertifyObjects}}
  <div class="row">
    <button class="btn btn-primary toFix" type=button style="margin-top:10px;margin-bottom:10px;margin-left:50px;">
      <i class="glyphicon glyphicon-stats"></i>
      Next: Fix >>
    </button>
  </div>
</template>
