 <template name="collect">
  <section class="right_col" role="main" style="padding-bottom:100px;">
      <div class ="row" >
        <h1 class="page_title">Collect</h1>
        <div id="addErrCollect" class="alert alert-danger" style="display:none;"></div>
        {{#if isValid}}
          {{#if hasObject}}
            {{#if hasEnoughObject}}
              {{> collectObjHeader}}
            {{else}}
              {{> collectOneObjHeader}}
            {{/if}}
          {{else}}
                {{> collectZeroObjHeader}}
          {{/if}}
          <div class="row">
            <div class="col-md-12">
              <div class="input-group" style="padding: 50px 20px 50px 20px;">
                <input id="objectlist" type="text" class="form-control" name="objectlist" />
                <div class="input-group-btn">
                  <button id="objddlbtn" type="button" class="btn btn-default dropdown-toggle sysddlbtn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" ><span class="caret"></span></button>
                    <ul id="objlistddl" class="dropdown-menu dropdown-menu-right objlistddl" style="max-height:300px;overflow-y:scroll;">
                      {{#if Template.subscriptionsReady}}
                        {{#each systems}}
                          {{> objectList}}
                        {{/each}}
                      {{/if}}
                    </ul>
                </div>
              </div>
            </div>
          </div>
          <div class="row" style="height:320px; overflow:hidden;background-color:#C1CCD3;margin-bottom:15px;">
            <div class="col-md-12" style="height:300px;max-height:300px;overflow-y:scroll;padding-top:15px;">
              {{#if Template.subscriptionsReady}}
                {{#each systems}}
                  {{> systemObjectList}}
                {{/each}}
              {{/if}}
            </div>
          </div>
          <div class="row">
            {{#if Template.subscriptionsReady}}
              {{#each external_objects}}
                {{> collectObj}}
              {{/each}}
            {{/if}}
          </div>
        {{else}}
          {{> invalidCollect}}
        {{/if}}
      </div>
  </section>
</template>

<template name="invalidCollect">
  <div class="row">
    <div class="col-md-12">
      <h4 style="padding-left:10px">Looks like you do not have any Systems connected.</h4>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <h4 style="padding-left:10px">You must have at least one System connected to begin collecting.
      </h4>
    </div>
  </div>
  <div class="row">
    <div class="col-md-3">
      <button class="btn btn-primary toConnect" type=button style="margin-top:10px;margin-left:10px;">
        Connect
      </button>
    </div>
    <div class="col-md-3">
    </div>
    <div class="col-md-3">
    </div>
    <div class="col-md-3">
    </div>
  </div>
</template>

<template name="systemObjectList">
  {{#each eo in external_objects}}
    {{#if doesntAlreadyExist eo.name id}}
      <div class="col-md-3 col-sm-3 col-xs-3 addobj" data-name="{{eo.name}}">
        <a href="#">
          <div class="x_panel">
            Name: {{eo.name}}<br />
            System Name: {{getSystemName id}}<br/>
            System Id: {{id}}<br/>
            Workspace Id: {{workspace_id}}<br/>
          </div>
        </a>
      </div>
    {{/if}}
  {{/each}}
</template>

<template name="objectList">
  {{#each eo in external_objects}}
    {{#if doesntAlreadyExist eo.name id}}
    <li>
      <a href="#" data-id="{{eo.name}}" data-name="{{eo.name}}" data-system="{{id}}">
        <img src="/images/{{getConnectorName id}}.png"
        alt="..." style="width:30px;height:30px; margin-right:10px;" >
        {{name}} - {{eo.name}}
      </a>
    </li>
    {{/if}}
  {{else}}
    <li><a href="#"> No objects found.</a></li>
  {{/each}}
</template>

<template name="collectObj">
    <div class="col-md-12 system" data-id="{{_id}}">
      <div class="x_panel">
        <div class="col-md-2"  >
            <img src="/images/{{getConnectorName system_id}}.png" alt=".." style="width:90px;height:90px;" >
        </div>
        <div class="col-md-2" style="padding-top:35px;">
          <h6>
          {{name}}
          </h6>
          <div id="objdetails{{_id}}" class="collapse" >
            ID: {{id}}<br/>
            Tenant: {{tenant_id}}<br/>
            System: {{system_id}}<br/>
            Workspace: {{workspace_id}}<br/>
            Properties: <br/>
            {{#each properties}}
              {{> collectObjProperty}}
            {{/each}}
          </div>
        </div>
        <div class="col-md-5" style="padding-top:5px">
          <p style="text-align:center">
            Collecting Data:
              {{getCollectedRecords record_count percentage}}
              of
              {{#if record_count}}{{record_count}}
              {{else}}0{{/if}} records ({{percentage}}%)<br/>
            Estimated Time Remaining: {{timeRemaining percentage}}
          </p>
          <div class="progress">
            <div class="progress-bar" data-id="{{id}}" role="progressbar" aria-valuenow="{{percentage}}" aria-valuemin="0" aria-valuemax="100" style="width: {{percentage}}%;">
            </div>
          </div>
        </div>
        <div class="col-md-1" style="text-align:right;padding-top:35px;">
          {{#if collectschema}}
            {{#if collect}}
              <p style="color:#72D2A4;">
                Collected
              </p>
            {{else}}
              <p style="color:#E81C57;">
                Collect Schema
              </p>
            {{/if}}
          {{else}}
            <p style="color:#E81C57;">
              Uncollected
            </p>
          {{/if}}
        </div>
        <div class="col-md-2" style="">
          <button class="btn btn-primary pull-right delete" type="button">
            <i class="glyphicon glyphicon-remove"></i>
          </button>
          <button class="btn btn-primary pull-right details" type="button" data-toggle="collapse" data-target="#objdetails{{_id}}">
            <i class="glyphicon glyphicon-chevron-down"></i>
          </button>
        </div>
      </div>
    </div>
</template>

<template name="collectObjProperty">
  <ul>
    <li>Property Name: {{name}}</li>
    <li>Is Customer: {{is_custom}}</li>
    <li>Is Array: {{is_array}} </li>
    <li>Type: {{type}}</li>
    <li>Is Key: {{is_key}}</li>
  </ul>
</template>

<!-- No Object Connected Header  -->
<template name="collectZeroObjHeader">
  {{#if hasWorkspace}}
    {{#if hasSystems}}
      <div class="row">
        <div class="col-md-12">
          <h4 style="padding-left:10px">
            Looks like you have no objects.
          </h4>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <h4 style="padding-left:10px">
            Search for objects to manage from the connected systems.
          </h4>
        </div>
      </div>
    {{else}}
      <div class="row">
        <div class="col-md-12">
          <h4 style="padding-left:10px">
            Looks like you have no systems connected. Add a system to continue.
          </h4>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <h4 style="padding-left:10px">
            <button class="btn btn-primary toConnect" type="button">
              <i class="glyphicon glyphicon-plus"></i>
              Add System
            </button>
          </h4>
        </div>
      </div>
    {{/if}}
  {{else}}
    <div class="row">
      <div class="col-md-12">
        <h4 style="padding-left:10px">
          Looks like you have no workspace connected. Please select a workspace to continue.
        </h4>
      </div>
    </div>
  {{/if}}
</template>

<!-- One Object Connected Header -->
<template name="collectOneObjHeader">
  <div class="row">
    <div class="col-md-12">
      <h4 style="padding-left:10px">

      </h4>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <h4 style="padding-left:10px">
          Add at least one more object to begin matching.
      </h4>
    </div>
  </div>
</template>

<!-- Collect Complete Header -->
<template name="collectObjHeader">
  <div class="row">
    <div class="col-md-12">
      <h4 style="padding-left:10px">
        <i class="glyphicon glyphicon-ok-circle"> </i>Collect Complete! Two objects connected.
      </h4>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <h4 style="padding-left:10px">
        Select another object to manage or start matching objects.
      </h4>
    </div>
  </div>
  <div class="row">
    <div class="col-md-3"> </div>
    <div class="col-md-3">
      <button class="btn btn-primary toConnect" type=button style="margin-top:10px;margin-bottom:10px;">
        <i class="glyphicon glyphicon-plus"></i>Connect Object
      </button>
    </div>
    <div class="col-md-3">
      <button class="btn btn-primary toMatch" type=button style="margin-top:10px;margin-bottom:10px;">
        Next: Match Objects
        <i class="glyphicon glyphicon-chevron-right"></i>
      </button>
    </div>
    <div class="col-md-3"> </div>
  </div>
</template>
